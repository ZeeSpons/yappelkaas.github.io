<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AppelRun - Yappelkaas</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="assets/favicon.png" type="image/png" />
</head>
<body>
  <header class="hero">
    <a href="index.html" class="menu-btn" style="position: absolute; top: 1rem; left: 1rem;">üè† Home</a>
    <h1>AppelRun</h1>
    <p>Ontwijk de kaas, verzamel de appels!</p>
  </header>

  <main class="kaasklikker">
    <canvas id="gameCanvas" width="1000" height="400" style="border: 2px solid #3399ff; background-color: #ffffff; display: block; margin: 2rem auto 0 auto; border-radius: 20px;"></canvas>

    <div style="max-width: 900px; margin: 2rem auto; text-align: left;">
      <h2>Hoe werkt het?</h2>
      <ul>
        <li>Druk op <strong>spatie</strong> of tik op het scherm om te springen.</li>
        <li>Pak <img src="assets/appel.png" alt="appel" style="height: 20px; vertical-align: middle;"> voor punten.</li>
        <li>Ontwijk <img src="assets/kaas.png" alt="kaas" style="height: 20px; vertical-align: middle;"> want dat is game over!</li>
        <li>Pak de zeldzame <img src="assets/zonnebril.png" alt="zonnebril" style="height: 20px; vertical-align: middle;"> om 5 seconden onoverwinnelijkheid te krijgen!</li>
      </ul>
      <p style="margin-top: 1.5rem;">
        Ben je af? Deel je highscore in de 
        <a href="https://discord.gg/J95ApheDKV" target="_blank" style="color: #5865F2; font-weight: bold; text-decoration: none;">
          <img src="assets/discord-icon.png" alt="Discord" style="height: 16px; vertical-align: text-bottom; margin-right: 4px;">
          Discord
        </a>!
      </p>
    </div>
  </main>

  <footer>
    <p>üçèüßÄ Yappelkaas 2025 ‚Äì Rennen voor je leven.</p>
  </footer>
  <p class="copyright">Gemaakt door: Zeespons.</p>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let runImg = new Image();
    runImg.src = "assets/appelkaas_run.png";
    let idleImg = new Image();
    idleImg.src = "assets/appelkaas_idle.png";

    let appelImg = new Image(); appelImg.src = "assets/appel.png";
    let kaasImg = new Image(); kaasImg.src = "assets/kaas.png";
    let zonnebrilImg = new Image(); zonnebrilImg.src = "assets/zonnebril.png";
    let mrDeluxeImg = new Image(); mrDeluxeImg.src = "assets/mrdeluxe_fly.png";

    let gameOverSound = new Audio("assets/gameover.mp3");

    let player = {
      x: 50,
      y: canvas.height - 150,
      width: 75,
      height: 150,
      velocityY: 0,
      grounded: true
    };

    let mrDeluxe = {
      active: false,
      x: -100,
      y: player.y,
      width: 60,
      height: 60
    };

    let gravity = 0.4;
    let jumpPower = -12;
    let obstacles = [];
    let score = 0;
    let speed = 3;
    let gameStarted = false;
    let gameOver = false;
    let framesSinceLastObstacle = 0;
    let obstacleCooldown = 100;
    let invincible = false;
    let invincibleTimer = 0;

    let highscore = parseInt(localStorage.getItem("appelrun_highscore")) || 0;

    function drawPlayer() {
      let img = (!gameStarted || gameOver) ? idleImg : runImg;
      const aspectRatio = img.width / img.height;
      const targetHeight = player.height;
      const targetWidth = targetHeight * aspectRatio;
      const offsetX = (player.width - targetWidth) / 2;

      ctx.drawImage(
        img,
        0, 0, img.width, img.height,
        player.x + offsetX, player.y,
        targetWidth, targetHeight
      );
    }

    function drawObstacle(ob) {
      const img = ob.type === "appel" ? appelImg : ob.type === "kaas" ? kaasImg : zonnebrilImg;
      ctx.drawImage(img, ob.x, ob.y, ob.width, ob.height);
    }

    function drawMrDeluxe() {
      if (!mrDeluxe.active) return;
      ctx.drawImage(mrDeluxeImg, mrDeluxe.x, mrDeluxe.y, mrDeluxe.width, mrDeluxe.height);
    }

    function resetGame() {
      if (score > highscore) {
        highscore = score;
        localStorage.setItem("appelrun_highscore", highscore);
      }
      player.y = canvas.height - player.height;
      player.velocityY = 0;
      player.grounded = true;
      obstacles = [];
      score = 0;
      speed = 3;
      gameOver = false;
      invincible = false;
      invincibleTimer = 0;
      mrDeluxe.active = false;
      mrDeluxe.x = -100;
    }

    function update() {
      if (!gameStarted || gameOver) return;

      player.velocityY += gravity;
      player.y += player.velocityY;
      if (player.y >= canvas.height - player.height) {
        player.y = canvas.height - player.height;
        player.velocityY = 0;
        player.grounded = true;
      } else {
        player.grounded = false;
      }

      if (invincible) {
        invincibleTimer--;
        mrDeluxe.x += 6;
        mrDeluxe.y = player.y - 10;
        if (invincibleTimer <= 0) {
          invincible = false;
          mrDeluxe.active = false;
          mrDeluxe.x = -100;
        }
      }

      for (let i = obstacles.length - 1; i >= 0; i--) {
        obstacles[i].x -= speed;
        if (obstacles[i].x + obstacles[i].width < 0) {
          obstacles.splice(i, 1);
        } else {
          const padding = 6;

          const px = player.x + padding;
          const py = player.y + padding;
          const pw = player.width - padding * 2;
          const ph = player.height - padding * 2;

          const ox = obstacles[i].x + padding;
          const oy = obstacles[i].y + padding;
          const ow = obstacles[i].width - padding * 2;
          const oh = obstacles[i].height - padding * 2;

          if (
            px < ox + ow &&
            px + pw > ox &&
            py < oy + oh &&
            py + ph > oy
          ) {
            if (obstacles[i].type === "kaas") {
              if (!invincible) {
                gameOver = true;
                gameOverSound.play();
                return;
              }
            } else if (obstacles[i].type === "zonnebril") {
              invincible = true;
              invincibleTimer = 60 * 5;
              mrDeluxe.active = true;
              mrDeluxe.x = player.x - 100;
            } else {
              obstacles.splice(i, 1);
              score++;
              if (score % 5 === 0 && speed < 10) speed += 0.3;
            }
          }
        }
      }

      framesSinceLastObstacle++;
      if (framesSinceLastObstacle >= obstacleCooldown) {
        let rand = Math.random();
        let type = rand < 0.01 ? "zonnebril" : rand < 0.6 ? "appel" : "kaas";
        obstacles.push({
          x: canvas.width,
          y: canvas.height - 70,
          width: 40,
          height: 40,
          type: type
        });
        framesSinceLastObstacle = 0;
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlayer();
      drawMrDeluxe();
      obstacles.forEach(drawObstacle);

      ctx.fillStyle = "#1e2b3a";
      ctx.font = "20px Segoe UI";
      ctx.fillText("Score: " + score, 10, 30);
      ctx.fillText("Highscore: " + highscore, 10, 55);

      if (!gameStarted) {
        ctx.fillStyle = "#1e2b3a";
        ctx.font = "26px Segoe UI";
        ctx.fillText("Druk op spatie of tik op het scherm!", 300, 200);
      }

      if (gameOver) {
        ctx.fillStyle = "#ff4d4d";
        ctx.font = "28px Segoe UI";
        ctx.fillText("Game Over!", 400, 180);
        ctx.fillStyle = "#1e2b3a";
        ctx.font = "20px Segoe UI";
        ctx.fillText("Druk op spatie of tik om opnieuw te spelen.", 280, 220);
      }
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    function handleJump() {
      if (!gameStarted || gameOver) {
        resetGame();
        gameStarted = true;
      } else if (player.grounded) {
        player.velocityY = jumpPower;
      }
    }

    document.addEventListener("keydown", function (e) {
      if (e.code === "Space") handleJump();
    });

    canvas.addEventListener("click", handleJump);
    canvas.addEventListener("touchstart", function (e) {
      e.preventDefault();
      handleJump();
    });

    gameLoop();
  </script>
</body>
</html>
