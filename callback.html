<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<title>Even inloggen...</title>
</head>
<body>
<p>Even inloggen via Discord... 🍪</p>
<script>
  const url = new URL(window.location.href);
  const code = url.searchParams.get("code");
  const state = url.searchParams.get("state"); // kaasklikker of appelrun

  if (!code || !state) {
    document.body.innerText = "Geen code of state in URL gevonden.";
  } else {
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbwwqhuYA4DgWVftl9z18nIIreJKLDqyvPgRh-trEM2a0TsfjQFGukvo0kFNIxxz0sku/exec';
    
    // Stuur code en state naar Apps Script en verwerk de response
    fetch(`${scriptUrl}?code=${encodeURIComponent(code)}&state=${encodeURIComponent(state)}`)
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          document.body.innerText = 'Fout: ' + data.error;
          return;
        }
        // Zet sessie data
        sessionStorage.setItem('discord_id', data.discord_id);
        sessionStorage.setItem('discord_username', data.discord_username);

        // Redirect naar juiste spel
        const redirectUrl = state === 'kaasklikker' 
          ? 'https://yappelkaas.nl/kaasklikker.html' 
          : 'https://yappelkaas.nl/appelrun.html';

        window.location.href = redirectUrl;
      })
      .catch(err => {
        document.body.innerText = 'Fout bij inloggen: ' + err;
      });
  }
</script>
</body>
</html>
